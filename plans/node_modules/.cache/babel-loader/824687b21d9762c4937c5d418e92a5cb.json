{"ast":null,"code":"var _jsxFileName = \"/Users/laurkankusu/Documents/development/domains-server/admin/src/components/modals/components/icon-add-modal/IconAddModal.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { SpinnerContext } from \"../../../spinner\";\nimport Konva from \"konva\";\nimport { getZones, rotateAroundCenter, drawSvg, drawTable, drawTableWithFurniture } from \"./functions\";\nimport \"./style.css\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar stage;\nvar layer;\n\nconst IconAddModal = _ref => {\n  _s();\n\n  let {\n    inputs\n  } = _ref;\n  const [loading, setLoading] = useState(false);\n\n  const closeModal = e => {\n    e.preventDefault();\n    document.querySelector('#inlineForm').style.display = \"none\";\n    document.querySelector('#inlineForm').classList.remove('show');\n    document.querySelector('body').classList.remove('modal-open');\n    document.querySelectorAll('.modal-dialog').forEach(modal => {\n      modal.style.display = \"none\";\n    });\n    document.querySelector('.modal-backdrop').remove();\n  };\n\n  useEffect(() => {\n    if (document.querySelector('.addIcon').style.display == \"flex\") {\n      const containerWidth = document.querySelector('.addIcon').offsetWidth;\n      const containerHeight = 400;\n      console.log('refresh');\n      stage = new Konva.Stage({\n        container: 'popup_canvas',\n        width: containerWidth,\n        height: containerHeight\n      });\n      layer = new Konva.Layer();\n      stage.add(layer);\n      let table;\n\n      if (Object.keys(inputs.icon.furnitures).length == 0) {\n        table = drawTable([0, 0], inputs.icon.width_cnt, inputs.icon.height_cnt, null, true, layer, {\n          width: containerWidth,\n          height: containerHeight\n        });\n      } else {\n        table = drawTableWithFurniture(inputs.icon, \"\", layer, inputs.furnitures, {\n          width: containerWidth,\n          height: containerHeight\n        }, furnitures => {\n          inputs.edit({ ...inputs.icon,\n            furnitures\n          });\n        });\n      }\n\n      let zones = getZones(table, true);\n      let zonesAlt = getZones(table, false);\n      /*zones.forEach((zone) => {\n          drawRect(zone.height, zone.width, zone.x,zone.y,layer)\n      })*/\n\n      drawFurnitures(layer, {\n        width: containerWidth,\n        height: containerHeight\n      }, zones, zonesAlt);\n      layer.draw();\n    }\n  }, [inputs.icon]);\n\n  const drawFurnitures = (layer, containerSize, zones, zonesAlt) => {\n    let x = 20;\n    inputs.furnitures.forEach(furniture => {\n      if (furniture.type == 0) {\n        if (furniture.ID == 3) {\n          drawSvg('/public/furnitures/' + furniture.ID + '/1.png', [x, containerSize.height - 40], 0.2, 0, layer, true, zonesAlt, furniture.ID, \"template\", furnitures => {\n            inputs.edit({ ...inputs.icon,\n              furnitures\n            });\n          });\n        } else {\n          drawSvg('/public/furnitures/' + furniture.ID + '/1.png', [x, containerSize.height - 40], 0.2, 0, layer, true, zones, furniture.ID, \"template\", furnitures => {\n            inputs.edit({ ...inputs.icon,\n              furnitures\n            });\n          });\n        }\n\n        if (x == 140) {\n          x += 35;\n        } else {\n          x += 60;\n        }\n      }\n    });\n  };\n\n  const inputChange = e => {\n    inputs.edit({ ...inputs.icon,\n      [e.target.name]: parseInt(e.target.value),\n      furnitures: {}\n    });\n  };\n\n  const showResultModal = flag => {\n    document.querySelectorAll('.modal-dialog').forEach(modal => {\n      modal.style.display = \"none\";\n    });\n\n    if (flag) {\n      document.querySelector('.modal-success').style.display = \"flex\";\n      setTimeout(() => {\n        document.querySelector('.modal-success').classList.add('show');\n      }, 100);\n      document.querySelector('.modal-success .modal-content').style.display = \"block\";\n    } else {\n      document.querySelector('.modal-danger').style.display = \"flex\";\n      setTimeout(() => {\n        document.querySelector('.modal-danger').classList.add('show');\n      }, 100);\n      document.querySelector('.modal-danger .modal-content').style.display = \"block\";\n    }\n  };\n\n  const addIcon = e => {\n    let json = inputs.icon;\n    json.furnitures = JSON.stringify(inputs.icon.furnitures);\n    json.position_xy = JSON.stringify(inputs.icon.position_xy);\n    console.log(json);\n    axios({\n      url: inputs.url,\n      method: inputs.type,\n      data: json,\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(response => {\n      if (inputs.type == \"put\") json.ID = response.data.id;\n      console.log(json);\n      inputs.action(json);\n      setLoading(false);\n      showResultModal(true);\n    }).catch(error => {\n      console.log(error);\n      setLoading(false);\n      showResultModal(false);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"modal-dialog modal-dialog-centered addIcon\",\n    role: \"document\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"modal-title\",\n          id: \"myModalLabel33\",\n          children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0438\\u043A\\u043E\\u043D\\u043A\\u0443 \\u0441\\u0442\\u043E\\u043B\\u0438\\u043A\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"close\",\n          onClick: closeModal,\n          \"data-dismiss\": \"modal\",\n          \"aria-label\": \"Close\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            \"aria-hidden\": \"true\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 21\n      }, this), loading ? /*#__PURE__*/_jsxDEV(SpinnerContext, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 30\n      }, this) : \"\", /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"popup_canvas\",\n        id: \"popup_canvas\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        action: \"#\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u043C\\u0435\\u0441\\u0442 \\u043F\\u043E \\u0448\\u0438\\u0440\\u0438\\u043D\\u0435\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control\",\n              onChange: inputChange,\n              type: \"number\",\n              name: \"width_cnt\",\n              value: inputs.icon.width_cnt\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: \"\\u041F\\u0440\\u043E\\u0432\\u0435\\u0440\\u044C\\u0442\\u0435 \\u043F\\u0440\\u0430\\u0432\\u0438\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C \\u0432\\u0432\\u043E\\u0434\\u0430 \\u043F\\u043E\\u043B\\u044F.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 148,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u043C\\u0435\\u0441\\u0442 \\u043F\\u043E \\u0432\\u044B\\u0441\\u043E\\u0442\\u0435\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control\",\n              onChange: inputChange,\n              type: \"number\",\n              name: \"height_cnt\",\n              value: inputs.icon.height_cnt\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invalid-feedback\",\n              children: \"\\u041F\\u0440\\u043E\\u0432\\u0435\\u0440\\u044C\\u0442\\u0435 \\u043F\\u0440\\u0430\\u0432\\u0438\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C \\u0432\\u0432\\u043E\\u0434\\u0430 \\u043F\\u043E\\u043B\\u044F.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"form-control\",\n          type: \"hidden\",\n          name: \"table_id\",\n          value: inputs.icon.table_id\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-footer\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn btn-outline-primary waves-effect waves-float waves-light\",\n            onClick: e => {\n              closeModal(e);\n              inputs.edit({ ...inputs.icon,\n                table_id: 0\n              });\n            },\n            \"data-dismiss\": \"modal\",\n            children: \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn btn-primary waves-effect waves-float waves-light\",\n            onClick: addIcon,\n            \"data-dismiss\": \"modal\",\n            children: \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 12\n  }, this);\n};\n\n_s(IconAddModal, \"bp7W7BLZaxNmS0ceaCBH82+KoGQ=\");\n\n_c = IconAddModal;\nexport default IconAddModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"IconAddModal\");","map":{"version":3,"sources":["/Users/laurkankusu/Documents/development/domains-server/admin/src/components/modals/components/icon-add-modal/IconAddModal.js"],"names":["React","useState","useEffect","SpinnerContext","Konva","getZones","rotateAroundCenter","drawSvg","drawTable","drawTableWithFurniture","axios","stage","layer","IconAddModal","inputs","loading","setLoading","closeModal","e","preventDefault","document","querySelector","style","display","classList","remove","querySelectorAll","forEach","modal","containerWidth","offsetWidth","containerHeight","console","log","Stage","container","width","height","Layer","add","table","Object","keys","icon","furnitures","length","width_cnt","height_cnt","edit","zones","zonesAlt","drawFurnitures","draw","containerSize","x","furniture","type","ID","inputChange","target","name","parseInt","value","showResultModal","flag","setTimeout","addIcon","json","JSON","stringify","position_xy","url","method","data","headers","Accept","then","response","id","action","catch","error","table_id"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\"\nimport { SpinnerContext } from \"../../../spinner\"\nimport Konva from \"konva\"\nimport  {getZones, rotateAroundCenter, drawSvg, drawTable,  drawTableWithFurniture} from \"./functions\"\nimport \"./style.css\"\nimport axios from \"axios\"\n\nvar stage\nvar layer\n\nconst IconAddModal = ({inputs}) => {\n    \n    const [loading, setLoading] = useState(false)\n    \n\n    \n\n    const closeModal = (e) => {\n        e.preventDefault()\n        document.querySelector('#inlineForm').style.display = \"none\"\n        document.querySelector('#inlineForm').classList.remove('show')\n        document.querySelector('body').classList.remove('modal-open')\n        document.querySelectorAll('.modal-dialog').forEach((modal) => {\n            modal.style.display = \"none\"\n        })\n        document.querySelector('.modal-backdrop').remove()\n    }\n\n    useEffect(()=>{\n            if (document.querySelector('.addIcon').style.display==\"flex\"){\n                const containerWidth = document.querySelector('.addIcon').offsetWidth\n                const containerHeight = 400\n                console.log('refresh')\n                stage = new Konva.Stage({\n                                container: 'popup_canvas',\n                                width: containerWidth,\n                                height: containerHeight,\n                            });\n            \n                \n                layer = new Konva.Layer();\n                stage.add(layer);\n                let table \n                if (Object.keys(inputs.icon.furnitures).length == 0) {\n                    table = drawTable([0, 0], inputs.icon.width_cnt, inputs.icon.height_cnt, null, true, layer, {width:containerWidth, height:containerHeight});\n                } else {\n                    table = drawTableWithFurniture(inputs.icon, \"\", layer, inputs.furnitures, {width:containerWidth, height:containerHeight}, (furnitures)=>{inputs.edit({...inputs.icon, furnitures})});\n                }\n                let zones = getZones(table, true)\n                let zonesAlt = getZones(table, false)\n                /*zones.forEach((zone) => {\n                    drawRect(zone.height, zone.width, zone.x,zone.y,layer)\n                })*/\n                drawFurnitures(layer, {width:containerWidth, height:containerHeight}, zones, zonesAlt)\n                layer.draw()\n            }\n        }, [inputs.icon]\n    )\n\n    const drawFurnitures = (layer, containerSize, zones, zonesAlt) => {\n        let x = 20\n        inputs.furnitures.forEach((furniture)=> {\n            if (furniture.type==0) {\n                if (furniture.ID==3){\n                    drawSvg( '/public/furnitures/'+furniture.ID+'/1.png', [x,containerSize.height-40], 0.2, 0, layer, true, zonesAlt, furniture.ID, \"template\", (furnitures)=>{inputs.edit({...inputs.icon, furnitures})});\n                } else {\n                    drawSvg( '/public/furnitures/'+furniture.ID+'/1.png', [x,containerSize.height-40], 0.2, 0, layer, true, zones, furniture.ID, \"template\", (furnitures)=>{inputs.edit({...inputs.icon, furnitures})});\n                }\n                if (x==140){\n                    x+=35\n                } else {\n                    x+=60\n                }\n            }\n        })\n    }\n\n    const inputChange = (e) => {\n        inputs.edit({\n            ...inputs.icon,\n            [e.target.name]:parseInt(e.target.value),\n            furnitures:{}\n        })\n    }\n\n    const showResultModal = (flag) => {\n        document.querySelectorAll('.modal-dialog').forEach((modal) => {\n            modal.style.display = \"none\"\n        })\n        if (flag) {\n            document.querySelector('.modal-success').style.display = \"flex\"\n            setTimeout(()=> {\n                document.querySelector('.modal-success').classList.add('show')\n            }, 100)\n            document.querySelector('.modal-success .modal-content').style.display=\"block\"\n        } else {\n            document.querySelector('.modal-danger').style.display = \"flex\"\n            setTimeout(()=> {\n                document.querySelector('.modal-danger').classList.add('show')\n            }, 100)\n            document.querySelector('.modal-danger .modal-content').style.display=\"block\"\n        }\n    }\n\n    const addIcon = (e) => {\n        let json = inputs.icon\n        json.furnitures = JSON.stringify(inputs.icon.furnitures)\n        json.position_xy = JSON.stringify(inputs.icon.position_xy)\n        console.log(json)\n        axios({\n            url: inputs.url,\n            method: inputs.type,\n            data: json,\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n            },\n        }).then((response) => {\n            if (inputs.type==\"put\") json.ID = response.data.id\n            console.log(json)\n            inputs.action(json)\n            setLoading(false)\n            showResultModal(true)\n        }).catch((error) => {\n            console.log(error)\n            setLoading(false)\n            showResultModal(false)\n        })\n    }\n\n    \n\n    return <div className={\"modal-dialog modal-dialog-centered addIcon\"} role=\"document\">\n                <div className=\"modal-content\">\n                    <div className=\"modal-header\">\n                        <h4 className=\"modal-title\" id=\"myModalLabel33\">Добавить иконку столика</h4>\n                        <button type=\"button\" className=\"close\" onClick={closeModal} data-dismiss=\"modal\" aria-label=\"Close\">\n                            <span aria-hidden=\"true\">×</span>\n                        </button>\n                    </div>\n                    {loading?<SpinnerContext />:\"\"}\n                    <div className=\"popup_canvas\" id=\"popup_canvas\">\n\n                    </div>\n                    <form action=\"#\">\n                        <div className=\"modal-body\">\n                            <label>Количество мест по ширине</label>\n                            <div className=\"form-group\">\n                                <input className=\"form-control\" onChange={inputChange} type=\"number\" name=\"width_cnt\" value={inputs.icon.width_cnt} />\n                                <div className=\"invalid-feedback\">Проверьте правильность ввода поля.</div>\n                            </div>\n                        </div>\n                        <div className=\"modal-body\">\n                            <label>Количество мест по высоте</label>\n                            <div className=\"form-group\">\n                                <input className=\"form-control\"  onChange={inputChange} type=\"number\" name=\"height_cnt\" value={inputs.icon.height_cnt} />\n                                <div className=\"invalid-feedback\">Проверьте правильность ввода поля.</div>\n                            </div>\n                        </div>\n                        <input className=\"form-control\" type=\"hidden\" name=\"table_id\" value={inputs.icon.table_id} />\n                        <div className=\"modal-footer\">\n                            <button type=\"button\" className=\"btn btn-outline-primary waves-effect waves-float waves-light\" onClick={(e) => {closeModal(e); inputs.edit({...inputs.icon, table_id:0})}} data-dismiss=\"modal\">Отмена</button>\n                            <button type=\"button\" className=\"btn btn-primary waves-effect waves-float waves-light\" onClick={addIcon} data-dismiss=\"modal\">Отправить</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n}\n\nexport default IconAddModal"]},"metadata":{},"sourceType":"module"}